## 3장 HTTP 메시지

## 목차
[1. 메시지의 흐름](#메시지의-흐름)

[2. 메시지의 각 부분](#메시지의-각-부분)

[3. 메서드](#메서드)

[3. 상태 코드](#상태-코드)



## 메시지의 흐름
- HTTP 메시지는 `무언가를 담아 보내는 소포`와 같다.
- HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 구조화된 블록들이다.

#### 메시지는 원 서버 방향을 인바운드로 하여 송신된다.
- 인바운드 : 메시지가 원 서버로 향하는 것
- 아웃바운드 : 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것

#### 다운스트림으로 흐르는 메시지
- 요청 메시지냐 응답 메시지냐에 관계없이 모든 메시지는 `다운스트림으로 흐른다.`
- 메시지는 결코 업스트림으로 흐르지 않는다.

## 메시지의 각 부분
- 각 메시지는 **클라이언트로부터의 요청**이나 **서버로부터의 응답** 중 하나를 포함한다.
- 메시지 구조
  - `시작줄` : 이것이 어떤 메시지인지 서술
  - `헤더 블록` : 속성
  - `본문` : 데이터(아예 없을 수도 있다.)

#### 메시지 문법
- 모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.
  - **요청 메시지** : 웹 서버에 어떤 동작을 요구한다.
  - **응답 메시지** : 요청의 결과를 클라이언트에게 돌려준다.
- 메시지 형식
  - `요청 메시지`
    - <메서드> <요청 URL> <버전>
    - <헤더>
    - <엔터티 본문>
  - `응답 메시지`
    - <버전> <상태 코드> <사유 구절>
    - <헤더>
    - <엔터티 본문>
- 메서드
  - 서버에게 무엇을 해야 하는지 말해준다.
  - `한 단어`로 되어있다. 
  - 예 : '`GET` /specials/saw-blade.gif HTTP/1.0' -> `메서드는 GET`이다.
  - 많이 쓰이는 HTTP 메서드
    - **GET** : 서버에서 어떤 문서를 `가져온다.`
    - **POST** : 서버가 처리해야할 데이터를 `보낸다`.
    - **PUT** : 서버에 요청메시지의 본문을 보내 `전체 수정한다`.
    - **PATCH** : 서버에 요청메시지의 본문을 보내 `부분 수정한다`.
    - **DELETE** : 서버에서 문서를 `제거한다.`
    - **HEAD** : 서버에서 어떤 문서에대해 `헤더만 가져온다.`
    - **TRACE** : 메시지가 프락시를 거쳐 `서버에 도달하는 과정을 추적한다.`
    - **OPTIONS** : 서버가 `어떤 메서드를 수행할 수 있는지 확인한다.`
- 요청 URL
  - 요청 대상이 되는 리소스를 지칭하는 완전한 URL / URL 경로 구성요소
- 버전
  - 이 메시지에서 사용 중인 HTTP의 버전
  - 형식 : HTTP/<메이저>,<마이너>
  - 자신이 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단
  - 대화 상대의 능력과 메시지의 형식에 대한 단서를 제공
  - 버전 번호는 어떤 애플리케이션이 지원하는 가장 높은 HTTP 버전을 가리킨다.
- 상태코드
  - 요청 중에 무엇이 일어났는지 설명하는 `세 자리의 숫자`
  - 상태의 일반적인 분류('성공', '에러' 등)을 나타낸다.
  - 많이 쓰이는 상태 코드들
    - `200` : OK - 성공!
    - `401` : Unauthorized - 사용자 이름과 비밀번호를 입력해야 한다.
    - `404` : Not Found - 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다.
- 사유 구절(reason-phrase)
  - 숫자된 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
  - 상태 코드 이후부터 줄바꿈 문자열까지
  - 오로지 사람에게 읽히기 위한 목적으로 존재
- 엔터티 본문
  - 모든 메시지가 엔터티 본문을 갖는 것은 아니다.
  - **헤더의 집합은 항상 빈 줄(그냥 CRLF)로 끝나야 함**

## 메서드

#### 안전한 메서드(Safe Method)
- GET / HEAD
  - GET과 HEAD는 안전하다고 할 수 있는데, 이는 GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.
  - 적용이 없다는 것은, HTTP 요청의 결과로 인해 서버에서 일어나는 일은 아무것도 없다는 의미.

###### 멱등성
- 멱등성이란?
  - 동일한 조건이라면 연산을 여러 번 실행해도 항상 동일한 결과를 보장해주는 성질
- HTTP Method
  - GET, HEAD, PUT, DELETE : 멱등성 O
  - POST : 멱등성 X

#### GET
- 가장 흔히 쓰이는 메서드
- 서버에게 리소스를 달라고 `요청`하기 위해 쓰인다.

#### HEAD
- GET처럼 행동하지만, 서버는 응답으로 `헤더만을 돌려준다.`
- 엔터티 본문은 결코 반환되지 않는다.
- 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있다.
- 응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있다.
- 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.

#### PUT
- 서버에 요청 메시지의 본문을 저장/덮어쓴다.
- 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것이다.
- 콘텐츠를 변경할 수 있게 해주기 때문에, 많은 웹 서버가 PUT을 수행하기 전에 사용자에게 **비밀번호를 입력해서 로그인을 하도록 요구**할 것이다.

#### POST
- 서버가 처리해야 할 데이터를 저장/게시한다. 

#### OPTIONS
- 웹 서버에게 여러 가지 종류의 `지원 범위`에 대해 물어본다.
- 서버에게 특정 리소스에 대해 `어떤 메서드가 지원되는지` 물어볼 수 있다.
- 여러 리소스에 대해 실제로 접근하지 않고도 그것들을 어떻게 접근하는 것이 최선인지 확인할 수 있는 수단을 클라이언트 애플리케이션에게 제공한다.

#### DELETE
- 서버에게 요청 URL로 지정한 리소스를 `삭제할 것을 요청`한다.
- 클라이언트는 삭제가 수행되는 것을 보장하지 못한다.

## 상태 코드
- 크게 다섯 가지로 분류
  - **100-199: 정보성 상태 코드**
  - **200-299: 성공 상태 코드**
  - **300-399: 리다이렉션 상태 코드**
  - **400-499: 클라이언트 에러 상태 코드**
  - **500-599: 서버 에러 상태 코드**
- 클라이언트에게 그들의 트랜잭션을 이해할 수 있는 쉬운 방법을 제공한다.

#### 200-299: 성공 상태 코드
- 클라이언트가 요청을 보내면, 그 요청은 대개 `성공`한다.
- 서버는 대응하는 성공을 의미하는 상태 코드의 배열을 갖고 있으며, 각각 다른 종류의 요청에 대응한다.
- 상태코드 / 사유 구절
  - `200 / OK`
    - 요청은 정상이고, 엔터티 본문은 요청된 리소스를 포함하고 있다.
  - `201 / Created`
    - 서버 개체를 생성하라는 요청(예: PUT)을 위한 것
    - 응답은, 생성된 리소스에 대한 최대한 구체적인 참조가 담긴 Location 헤더와 함께, 그 리소스를 참조할 수 있는 여러 URL을 엔터티 본문에 포함해야 한다.
  - `204 / No Content`
    - 응답 메시지는 헤더와 상태줄을 포함하지만 엔터티 본문은 포함하지 않는다.
    - 주로 웹브라우저를 새 문서로 이동시키지 않고 갱신하고자 할 때 사용한다.

#### 300-399: 리다이렉션 상태 코드
- 클라이언트가 관심있어 하는 `리소스에 대해 다른 위치를 사용하라고 말해주거나` 그 리소스의 내용 대신 `다른 대안 응답을 제공`한다.
- HEAD가 아닌 요청에 대해 리다이렉션 상태 코드를 포함한 응답을 할 때, **리다이렉트될 URL에 대한 링크와 설명을 포함시키는 것은 좋은 습관이다.**
  - `Location` header : HTTP Response Header 에 리다이렉트될 URL 을 넣는다.
- 상태코드 / 사유 구절
  - `301 / Moved Permanently`
      - 요청한 URL이 옮겨졌을 때 사용
      - 응답은 Location 헤더에 현재 리소스가 존재하고 있는 URL을 포함해야 한다.
  - `304 / Not Modified`
      - 클라이언트는 헤더를 이용해 조건부 요청을 만들 수 있다.
      - 만약 클라이언트가 GET과 같은 조건부 요청을 보냈고 그 요청한 리소스가 최근에 수정된 일이 없다면, 이 코드는 리소스가 수정되지 않았음을 의미하게 된다.
      - 이 상태 코드를 동반한 응답은 엔터티 본문을 가져서는 안된다.
  - `307 / Temporary Redirect`
      - 301 상태코드와 비슷하다. 그러나 클라이언트는 Location 헤더로 주어진 URL을 리소스를 `임시로 가리키기 위한 목적`으로 사용해야 한다.
      - 이후의 요청에서는 원래 URL을 사용해야 한다.

#### 400-499: 클라이언트 에러 상태 코드
- 가끔 클라이언트는 서버가 다룰 수 없는 무엇인가를 보낸다.
  - 잘못 구성된 요청 메시지나 존재하지 않는 URL에 대한 요청
- 상태코드 / 사유 구절
    - `400 / Bad Request`
        - 클라이언트가 잘못된 요청을 보낸다고 말해준다.
    - `401 / Unauthorized`
        - 리소르를 얻기 전에 클라이언트에게 **스스로를 인증하라고 요구하는 내용의 응답**을 적절한 헤더와 함께 반환한다.
    - `403 / Forbidden`
        - 요청이 서버에 의해 거부되었음을 알려주기 위해 사용
        - 만약 서버가 왜 요청이 거부되었는지 알려주고자 한다면, 서버는 그 이유를 설명하는 엔터티 본문을 포함시킬 수 있다.
        - 그러나 이 코드는 보통 서버가 거절의 이유를 숨기고 싶을 때 사용한다.
    - `404 / Not Found`
      - 서버가 요청한 URL을 찾을 수 없음을 알려주기 위해 사용
      - 종종, 클라이언트 애플리케이션이 사용자에게 보여주기 위한 엔터티가 포함된다.

#### 500-599: 서버 에러 상태 코드
- 클라이언트가 올바른 요청을 보냈음에도 서버 자체에서 에러가 발생하는 경우가 있다.
- 상태코드 / 사유 구절
    - `500 / Internal Server Error`
        - 서버가 요청을 처리할 수 없게 만드는 에러를 만났을 때 사용한다.
    - `503 / Service Unavailable`
      - 현재는 서버가 요청을 처리해 줄 수 없지만 나중에는 가능함을 의미하고자 할 때 사용
      - 만약 서버가 언제 그 리소스를 사용할 수 있게 될지 알고 있다면, 서버는 Retry-After 헤더를 응답에 포함시킬 수 있다.
